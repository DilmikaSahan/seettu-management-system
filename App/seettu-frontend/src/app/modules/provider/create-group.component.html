<div class="create-group-container">
  <div class="form-header">
    <h1>Create Seettu Group</h1>
    <p>Set up a new seettu group with members and payment schedule</p>
  </div>

  <form (ngSubmit)="onSubmit()" #groupForm="ngForm" class="group-form">
    <!-- Basic Group Information -->
    <div class="form-section">
      <h3>Group Information</h3>
      
      <div class="form-group">
        <label for="groupName">Group Name *</label>
        <input
          type="text"
          id="groupName"
          name="groupName"
          [(ngModel)]="groupData.groupName"
          required
          class="form-control"
          placeholder="Enter group name"
        />
      </div>

      <div class="form-group">
        <label for="packageId">Select Package *</label>
        <select
          id="packageId"
          name="packageId"
          [(ngModel)]="groupData.packageId"
          required
          class="form-control"
        >
          <option value="">Select a package</option>
          <option *ngFor="let pkg of packages" [value]="pkg.id">
            {{ pkg.packageName }} - LKR {{ pkg.packageValue }}
          </option>
        </select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="monthlyAmount">Monthly Amount (LKR) *</label>
          <input
            type="number"
            id="monthlyAmount"
            name="monthlyAmount"
            [(ngModel)]="groupData.monthlyAmount"
            required
            min="0"
            step="0.01"
            class="form-control"
            placeholder="0.00"
          />
        </div>

        <div class="form-group">
          <label for="numberOfMonths">Number of Months *</label>
          <input
            type="number"
            id="numberOfMonths"
            name="numberOfMonths"
            [(ngModel)]="groupData.numberOfMonths"
            required
            min="1"
            max="60"
            class="form-control"
            placeholder="12"
            (ngModelChange)="onMonthsChange()"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="startDate">Start Date *</label>
        <input
          type="date"
          id="startDate"
          name="startDate"
          [(ngModel)]="groupData.startDate"
          required
          class="form-control"
        />
      </div>
    </div>

    <!-- Member Management -->
    <div class="form-section">
      <h3>Add Members</h3>
      
      <div class="member-search">
        <div class="search-input-group">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (ngModelChange)="searchSubscribers()"
            placeholder="Search by name, phone, or ID"
            class="form-control"
            name="searchTerm"
          />
          <button type="button" class="btn btn-secondary" (click)="searchSubscribers()">
            Search
          </button>
        </div>

        <div class="search-results" *ngIf="searchResults.length > 0">
          <div class="search-result" *ngFor="let user of searchResults">
            <div class="user-info">
              <strong>{{ user.name }}</strong>
              <span>{{ user.phoneNumber || 'No phone' }}</span>
              <span>ID: {{ user.userId || 'No ID' }}</span>
            </div>
            <button
              type="button"
              class="btn btn-sm btn-primary"
              (click)="addMember(user)"
              [disabled]="isMemberAdded(user.id!)"
            >
              {{ isMemberAdded(user.id!) ? 'Added' : 'Add' }}
            </button>
          </div>
        </div>
      </div>

      <div class="selected-members" *ngIf="groupData.members.length > 0">
        <h4>Selected Members ({{ groupData.members.length }})</h4>
        <div class="member-list">
          <div class="member-item" *ngFor="let member of groupData.members; let i = index">
            <div class="member-info">
              <strong>{{ getMemberName(member.userId) }}</strong>
              <span>Order: {{ member.orderNumber }}</span>
            </div>
            <div class="member-actions">
              <input
                type="number"
                [(ngModel)]="member.orderNumber"
                [name]="'orderNumber_' + i"
                min="1"
                [max]="groupData.numberOfMonths"
                class="order-input"
                placeholder="Order"
              />
              <button
                type="button"
                class="btn btn-sm btn-danger"
                (click)="removeMember(i)"
              >
                Remove
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="goBack()">
        Cancel
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="groupForm.invalid || isSubmitting || groupData.members.length === 0"
      >
        {{ isSubmitting ? 'Creating...' : 'Create Group' }}
      </button>
    </div>
  </form>
</div>